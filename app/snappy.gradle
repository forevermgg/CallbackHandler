afterEvaluate {
    // Define a Task that will add a snappy dependency, downloading
    // the source from GitHub if needed.
    println "projectDir:" + projectDir
    println "rootDir:" + rootDir
    println "buildDir:" + buildDir
    task gitCheckOutSnappy {
        // Locate or download snappy.
        def snappyDir = "$rootDir/third_party/snappy"
        def snappyFolder = new File(snappyDir)
        if (!snappyFolder.exists()) {
            exec {
                executable 'git'
                args 'clone',
                        '--branch',
                        '1.1.10',
                        '--depth',
                        '1',
                        'https://github.com/google/snappy.git',
                        snappyDir
            }
        }
    }
    // https://zhuanlan.zhihu.com/p/112294419
    tasks.register('copyTask', Copy) {
        from "$rootDir/third_party/snappy-stubs-public.h"
        into "$rootDir/third_party/snappy"
    }
    preBuild.dependsOn gitCheckOutSnappy
    preBuild.dependsOn copyTask
}